<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.uniess.vk.batch.repository.ImageMapper">
    <select id="findOneByCotId" parameterType="string" resultType="string">
        SELECT IMG_ID FROM IMAGE WHERE COT_ID = #{cotId} AND URL = #{url}
    </select>

    <select id="findAllByCotId" parameterType="string" resultType="arraylist">
        SELECT IMG_ID,
               COT_ID,
               URL,
               IMAGE_DESCRIPTION,
               IS_THUBNAIL,
               IMAGE_PATH
          FROM IMAGE
         WHERE COT_ID = #{cotId}
    </select>

    <select id="findOneByContentId" parameterType="string" resultType="string">
        SELECT IMG_ID FROM IMAGE WHERE COT_ID = COTID(#{contentId}) AND URL = #{url}
    </select>

    <select id="findAllByContentId" parameterType="string" resultType="arraylist">
        SELECT IMG_ID,
               COT_ID,
               URL,
               IMAGE_DESCRIPTION,
               IS_THUBNAIL,
               IMAGE_PATH
          FROM IMAGE
         WHERE COT_ID = COTID(#{cotId})
    </select>

    <insert id="insert" parameterType="image">
        INSERT INTO IMAGE (
            IMG_ID,
            COT_ID,
            URL,
            IMAGE_DESCRIPTION,
            IS_THUBNAIL,
            IMAGE_PATH
        ) VALUES (
            #{imageId},
            #{cotId},
            #{originimgurl},
            #{imgname},
            #{thumbnail}, -- TODO smallimageurl 를 이용하여 썸네일인지 여부 확인후 `0`또는 `1`값으로 ...
            null
        )
    </insert>

    <update id="update" parameterType="image">
        UPDATE IMAGE
        <set>
            <if test="originimgurl != null">URL = #{originimgurl},</if>
            <if test="imgname != null">IMAGE_DESCRIPTION = #{imgname},</if>
            <if test="thumbnail != null">IS_THUBNAIL = #{thumbnail} -- TODO smallimageurl</if>
        </set>
         WHERE COT_ID = #{cotId}
           AND URL = #{originimgurl}
    </update>
</mapper>